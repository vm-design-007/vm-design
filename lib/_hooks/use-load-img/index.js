"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const u=require("vue"),b=require("../../_utils/utils/index.js"),S=require("../use-run/index.js");require("../../loading/src/index2.js");require("../use-message/index.js");const I=(o,t,d)=>{const{run:v}=S.useRun(),a=u.ref(!0),f=u.ref(!1);let g=!1;const h=(e,n,r)=>{e.src=r,a.value=!0,f.value=!0,v(t.onLoad,n)},L=e=>{a.value=!1,v(t.onError,e)},i=(e,n)=>{const r=new Image;new Promise((s,l)=>{r.src=n||t.src,r.addEventListener("load",c=>{s(c)}),r.addEventListener("error",c=>{l(c)})}).then(s=>{s&&h(e,s,r.src)}).catch(s=>{if(!g&&t.errSrc){i(e,t.errSrc),g=!0;return}L(s)})},E=e=>{const n=new IntersectionObserver(r=>{r[0].isIntersecting&&(i(e),n.unobserve(e))},{rootMargin:b.sizeChange(t.rootMargin)});return n},M=e=>{const n=()=>{const r=window.innerHeight||document.documentElement.clientHeight,s=document.documentElement.scrollTop||document.body.scrollTop,l=e.offsetParent.offsetTop,c=r+s-l;Math.abs(c)<Math.abs(b.sizeToNum(t.rootMargin))&&(i(e),window&&window.removeEventListener("scroll",n))};window&&window.addEventListener("scroll",n)},m=()=>{if(!!o.value){if(t.lazy){IntersectionObserver?E(o.value).observe(o.value):M(o.value);return}i(o.value)}},w=()=>{if(d){if(d())m();else return;return}m()};return u.onMounted(()=>{w()}),u.watch(()=>t.src,()=>{w()}),{isSuccess:a,isShowNode:f}};exports.useLoadImg=I;
